---
phase: 02-complete-game
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified: [game.js]
autonomous: true

must_haves:
  truths:
    - "Fake watch names progress from obviously ridiculous early to near-miss misspellings late in the round"
    - "Slashing a real watch shows floating 'Bonne affaire!' text, slashing a fake shows 'Arnaque!'"
    - "A rare golden watch sometimes appears -- larger, gold-colored -- and gives big bonus euros when slashed"
    - "Consecutive correct slashes build a combo multiplier (x2, x3...) that resets on mistakes"
    - "A live Vinted star rating (1-5 stars) with French label updates during gameplay based on score"
    - "Game over screen shows Vinted rating, birthday message, and score breakdown"
  artifacts:
    - path: "game.js"
      provides: "Humor content, combo system, golden watch, Vinted rating, birthday message"
      contains: "FAKE_NAMES_PROGRESSION"
      min_lines: 1300
  key_links:
    - from: "spawnWatch"
      to: "pickFakeName(t)"
      via: "time-based fake name selection"
      pattern: "pickFakeName"
    - from: "slashWatch"
      to: "combo / comboMultiplier"
      via: "combo increment on real, reset on fake"
      pattern: "combo\\+\\+|combo = 0"
    - from: "slashWatch"
      to: "spawnFloatingText with label"
      via: "Bonne affaire / Arnaque text spawning"
      pattern: "Bonne affaire|Arnaque"
    - from: "drawWatch"
      to: "isGolden check"
      via: "golden case color override"
      pattern: "isGolden.*#DAA520|goldenrod"
    - from: "renderRating / renderGameOver"
      to: "getRating(score)"
      via: "score-to-stars mapping"
      pattern: "getRating|Roi du Vinted"
    - from: "renderGameOver"
      to: "birthday message"
      via: "hardcoded exact text from user"
      pattern: "Joyeux anniversaire"
---

<objective>
Add all humor content and polish to the game: fake name progression (key comedy beat), floating feedback text ("Bonne affaire!" / "Arnaque!"), golden watch bonus, combo multiplier system, live Vinted seller rating, and birthday message on game over screen.

Purpose: This is what makes the game funny and personal for Thomas. The fake name progression IS the joke. The Vinted rating creates tension. The birthday message is the payoff.
Output: Complete game.js with all Phase 2 features -- ready for deployment in Phase 3.
</objective>

<execution_context>
@/Users/jimmydore/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jimmydore/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-complete-game/02-CONTEXT.md
@.planning/phases/02-complete-game/02-RESEARCH.md
@.planning/phases/02-complete-game/02-01-SUMMARY.md
@game.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fake name progression, enhanced floating feedback, and golden watch</name>
  <files>game.js</files>
  <action>
  Add the three content features that make individual watch interactions funnier and more rewarding.

  **1. Fake name progression (KEY COMEDY BEAT):**

  Replace the existing flat `FAKE_NAMES` array with a progression array ordered from obviously ridiculous to near-miss:
  ```javascript
  var FAKE_NAMES_PROGRESSION = [
    // t = 0.0-0.3: Obviously ridiculous (easy to spot, gets laughs)
    'Montagniak', 'Montignoque', 'Mortignac', 'Monticrap', 'Montignul',
    // t = 0.3-0.6: Getting sneakier
    'Montignak', 'Montinyac', 'Montigniak', 'Montigrac',
    // t = 0.6-1.0: Near-misses (hard to spot under time pressure!)
    'Montigac', 'Montiganc', 'Montignaq', 'Montignae'
  ];
  ```

  Add a `pickFakeName(t)` function that selects from the appropriate tier based on normalized time progress `t`:
  - Compute a tier start index: `Math.floor(t * FAKE_NAMES_PROGRESSION.length * 0.7)` (biases toward easier names early)
  - Pick randomly within a 3-name window starting from tierStart
  - Clamp index to array bounds

  In `spawnWatch(diff)`, replace the old `FAKE_NAMES[Math.floor(Math.random() * FAKE_NAMES.length)]` with `pickFakeName(Math.min(1, elapsed / ROUND_DURATION))`.

  Keep the old `FAKE_NAMES` variable for backward compatibility or remove it -- either way, spawnWatch must use `pickFakeName()`.

  **2. Enhanced floating feedback text:**

  Modify `spawnFloatingText()` to accept an optional `label` parameter (string). When provided, spawn TWO floating texts at the same x but slightly different y:
  - The label text ("Bonne affaire!", "Arnaque!", etc.) at the slash point, 16px font
  - The euro amount at slashY + 22px offset, 22px font (existing behavior)

  Or simpler: just spawn two entries in the floatingTexts array with different y offsets and font sizes.

  In `slashWatch()`, change the `spawnFloatingText` call to also spawn the label:
  - Real watch (not golden): spawn "Bonne affaire !" in green (50, 180, 80) at (watch.x, watch.y - 15), 16px, plus the euro amount below
  - Fake watch: spawn "Arnaque !" in red (220, 50, 50) at (watch.x, watch.y - 15), 16px, plus the euro amount below
  - Golden watch: spawn "JACKPOT !" in gold (255, 215, 0) at (watch.x, watch.y - 15), 18px bold, plus the euro amount below

  Add a `fontSize` field to floatingText objects (default 22 for euro amounts, 16 for labels, 18 for golden). Use this in `renderFloatingTexts()` to set font size per text.

  **3. Golden watch:**

  In `spawnWatch(diff)`, after determining `isFake`, add golden watch logic:
  ```javascript
  var isGolden = !isFake && Math.random() < 0.03; // 3% of real watches
  ```

  When `isGolden` is true:
  - Set `watch.isGolden = true`
  - Set `watch.value = 50` (big bonus, before combo multiplier)
  - Set `watch.size = WATCH_SIZE * 1.2` (slightly larger, noticeable)
  - Brand stays "Montignac" (golden watches are always real)

  In `drawWatch()`, add golden watch case color: if `watch.isGolden`, set caseColor to `'#DAA520'` (goldenrod) regardless of fake/sneaky logic. This goes BEFORE the existing fake/sneaky color check:
  ```javascript
  if (watch.isGolden) {
    caseColor = '#DAA520';
  } else if (watch.isFake && !watch.sneaky) {
    caseColor = '#cc3333';
  } else {
    caseColor = '#2a7d4f';
  }
  ```

  ALSO apply the same golden color override in `renderHalf()` for split halves -- the tempWatch color determination must also check `half.isGolden` (add `isGolden` to the createSplitHalves output).

  In `spawnParticles()`, when slashing a golden watch, use gold particles: color `'255, 215, 0'`. Pass an `isGolden` flag through to `spawnParticles(x, y, isFake, count, isGolden)`.

  In `slashWatch()`, track golden slashes: `if (watch.isGolden) stats.goldenSlashed++`.
  </action>
  <verify>
  Open index.html, tap "Jouer", and play through:
  1. Early game (0-20s): fake names are obviously ridiculous ("Montagniak", "Montignoque") -- easy to spot
  2. Late game (40-60s): fake names are sneaky near-misses ("Montignaq", "Montignae") -- hard to spot
  3. Slashing a real watch shows green "Bonne affaire !" + euro amount
  4. Slashing a fake shows red "Arnaque !" + euro amount
  5. Golden watches appear occasionally (~3% chance) -- noticeably larger and gold-colored
  6. Slashing a golden watch shows gold "JACKPOT !" text and +50 euros (or more with combo)
  7. Golden watch split halves are also gold-colored
  </verify>
  <done>
  Fake names progress from obvious to subtle over 60 seconds. Floating feedback shows French labels. Golden watches spawn at 3%, appear gold and larger, give +50 euros bonus.
  </done>
</task>

<task type="auto">
  <name>Task 2: Combo system, live Vinted rating, and birthday message on game over</name>
  <files>game.js</files>
  <action>
  Add the combo multiplier system, live Vinted seller rating during gameplay, and complete the game over screen with rating and birthday message.

  **1. Combo system:**

  Add state variables near the top (in game state section):
  ```javascript
  var combo = 0;
  var comboMultiplier = 1;
  ```

  Add `getMultiplier()` function:
  ```javascript
  function getMultiplier(combo) {
    if (combo >= 15) return 5;
    if (combo >= 10) return 4;
    if (combo >= 6) return 3;
    if (combo >= 3) return 2;
    return 1;
  }
  ```

  Modify `slashWatch()`:
  - When slashing a REAL watch (including golden): increment `combo`, recalculate `comboMultiplier = getMultiplier(combo)`, apply multiplier to value: `watch.value = watch.value * comboMultiplier`. Update `stats.maxCombo = Math.max(stats.maxCombo, combo)`.
  - When slashing a FAKE watch: reset `combo = 0; comboMultiplier = 1;`. Fake penalty is flat (NOT multiplied).

  Modify missed-watch penalty in `updateWatches()`: when a real unslashed watch exits screen (existing penalty code), ALSO reset `combo = 0; comboMultiplier = 1;`.

  Add combo to `resetGame()`: `combo = 0; comboMultiplier = 1;`

  **Combo display (renderCombo function):** Called in render() after renderScore().
  - Only show when `comboMultiplier > 1`
  - Display "x{comboMultiplier}" text below the score pill (left side, ~y=52)
  - Font: bold 20px, color gold (#FFD700)
  - Optional: brief scale-up animation when multiplier increases (track a `comboDisplayScale` that starts at 1.3 and lerps to 1.0 over 0.3s)

  **2. Live Vinted seller rating:**

  Add `getRating()` function:
  ```javascript
  function getRating(score) {
    if (score >= 300) return { stars: 5, label: 'Roi du Vinted' };
    if (score >= 150) return { stars: 4, label: 'Vendeur confirm\u00e9' };
    if (score >= 50)  return { stars: 3, label: 'Bon vendeur' };
    if (score >= 0)   return { stars: 2, label: 'Vendeur d\u00e9butant' };
    return { stars: 1, label: 'Vendeur douteux' };
  }
  ```

  Add `renderRating()` function -- displayed during gameplay (called in render()):
  - Position: top-right corner, mirroring the score pill in top-left
  - Semi-transparent dark pill background (like score pill): roundRect at right side
  - Stars: Unicode filled stars U+2605 and empty stars U+2606, gold color (#FFD700), bold 16px
  - Label text below stars: white, 11px
  - Right-aligned: `ctx.textAlign = 'right'`, x = canvasWidth - 15

  **3. Complete game over screen:**

  Enhance the `renderGameOver()` function (created in 02-01) to add:

  After the score breakdown stats, add:

  **Vinted rating display (larger version):**
  - Stars in 24px gold, centered
  - Label in 18px white, centered, below stars
  - This is the "verdict" -- make it visually prominent

  **Birthday message:**
  - Exact text: "Joyeux anniversaire mon fr\u00e8re,\nlongue vie aux montres\net \u00e0 Montignac"
  - Split across 3 lines manually (no dynamic word wrap needed)
  - Font: 18px, white with slight gold tint or italic style to feel special
  - Centered, positioned below the rating, at roughly 60-65% screen height
  - Add a small decorative element: a line of small watch emoji or stars above/below the message (simple horizontal line of 3 unicode stars)

  **Layout from top to bottom (game over screen):**
  1. ~12% height: "Temps \u00e9coul\u00e9 !" header (28px bold white)
  2. ~25% height: Stats block (18px white, 26px line spacing):
     - "Montres vendues : {realSlashed}"
     - "Contrefacons tranch\u00e9es : {fakeSlashed}"
     - "Profit final : {score}\u20AC"
     - If goldenSlashed > 0: "Montres en or : {goldenSlashed}"
     - "Meilleur combo : x{maxCombo}" (only if maxCombo >= 3)
  3. ~50% height: Rating verdict -- stars + label (large, prominent)
  4. ~62% height: Birthday message (3 lines, warm tone)
  5. ~80% height: "Rejouer" button

  Make sure the birthday message uses proper French accented characters with Unicode escapes in the string to guarantee they render correctly.

  **Important integration detail:** The `render()` function (playing state) must call these new render functions in the right order:
  - After existing renderScore(): call renderTimer(), renderCombo(), renderRating()
  - The HUD renders on top of everything (after particles, floating texts, etc.)
  </action>
  <verify>
  Open index.html, tap "Jouer", and play a full round:
  1. Slash 3 real watches in a row -- "x2" combo indicator appears below score
  2. Slash 3 more -- combo increases to "x3", euro amounts on floating text reflect multiplier
  3. Accidentally slash a fake -- combo resets, "x" indicator disappears
  4. Check top-right corner: Vinted rating (stars + label) updates as score changes
  5. Score below 0: "Vendeur douteux" (1 star). Score 50+: "Bon vendeur" (3 stars). Etc.
  6. Let timer run to 0 -- game over screen shows:
     - Stats breakdown (watches slashed, fakes caught, profit)
     - Large Vinted rating with stars and label
     - Birthday message: "Joyeux anniversaire mon frere, longue vie aux montres et a Montignac" (with accents)
     - "Rejouer" button
  7. Tap "Rejouer" -- new round starts, combo at 0, rating fresh
  </verify>
  <done>
  Combo system builds multiplier on consecutive correct slashes (x2 at 3, x3 at 6, x4 at 10, x5 at 15), resets on mistakes. Live Vinted rating with 5 tiers updates during gameplay. Game over shows full stats, rating verdict, exact birthday message, and replay button.
  </done>
</task>

</tasks>

<verification>
Full end-to-end playthrough:
1. Load game -- start screen with Thomas's name, decorative watches, "Jouer" button
2. Tap "Jouer" -- gameplay starts with 60s timer
3. First 20 seconds: slow spawns, obvious fake names ("Montagniak"), mostly real watches
4. Slash real watches: green "Bonne affaire !" floats up, score increases
5. Build combo to x3: gold "x3" shows below score, euro values reflect 3x multiplier
6. Slash a fake: red "Arnaque !" floats up, combo resets
7. Golden watch appears: larger, gold-colored, slashing gives "JACKPOT !" + 50 euros x multiplier
8. Top-right: live Vinted rating updates (stars + French label)
9. Last 15 seconds: frantic spawning, sneaky fake names ("Montignaq"), fast watches
10. Timer hits 0: game over shows stats, Vinted rating verdict, birthday message
11. Birthday message reads exactly: "Joyeux anniversaire mon frere, longue vie aux montres et a Montignac" (with accents)
12. Tap "Rejouer": clean fresh round
</verification>

<success_criteria>
- Fake names progress from "Montagniak" (obvious) to "Montignaq" (sneaky) over 60 seconds
- Slashing shows "Bonne affaire !" / "Arnaque !" / "JACKPOT !" floating labels
- Golden watches appear at ~3%, gold-colored, 1.2x size, +50 euro bonus
- Combo multiplier builds (x2/x3/x4/x5) on consecutive correct slashes, resets on mistakes
- Live Vinted rating (1-5 stars + French label) visible during gameplay
- Game over shows stats, large rating, birthday message, replay button
- Birthday message is the exact text from user with proper French accents
- All new state variables reset properly on replay
</success_criteria>

<output>
After completion, create `.planning/phases/02-complete-game/02-02-SUMMARY.md`
</output>
