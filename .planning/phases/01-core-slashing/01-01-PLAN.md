---
phase: 01-core-slashing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [index.html, game.js]
autonomous: true

must_haves:
  truths:
    - "Opening index.html on mobile Chrome shows a full-screen teal gradient canvas with no scroll, zoom, or browser UI interference on touch"
    - "Swiping a finger across the canvas draws a visible gold fading trail that follows the finger in real time"
    - "The game loop runs at 60fps with frame-rate-independent delta time"
    - "The canvas is sharp on high-DPI mobile screens (no blurriness)"
  artifacts:
    - path: "index.html"
      provides: "HTML shell with viewport meta, CSS reset, touch-action:none, canvas element, script tag loading game.js"
      contains: "touch-action"
    - path: "game.js"
      provides: "Game loop, input handling, trail rendering, background rendering, score display stub"
      min_lines: 100
  key_links:
    - from: "index.html"
      to: "game.js"
      via: "script tag"
      pattern: "<script src=\"game\\.js\">"
    - from: "game.js (pointerdown/pointermove)"
      to: "game.js (trailPoints array)"
      via: "Pointer Events push to trail array"
      pattern: "trailPoints\\.push"
    - from: "game.js (gameLoop)"
      to: "game.js (update + render)"
      via: "requestAnimationFrame"
      pattern: "requestAnimationFrame"
---

<objective>
Set up the complete rendering and input foundation for Watch Ninja: a full-screen mobile Canvas game with a teal gradient background, a gold swipe trail that fades behind the finger, and a game loop with delta time. After this plan, the game shell is playable -- you can open it on a phone, see the background, swipe to draw a trail, and see a score display (showing 0EUR).

Purpose: Everything in Plan 02 (watches, physics, scoring) depends on having a working canvas, game loop, and input system. This foundation must be solid before adding game entities.

Output: index.html + game.js -- a working mobile game shell with swipe trail.
</objective>

<execution_context>
@/Users/jimmydore/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jimmydore/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-slashing/01-CONTEXT.md
@.planning/phases/01-core-slashing/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create HTML shell and Canvas initialization</name>
  <files>index.html, game.js</files>
  <action>
Create index.html as the HTML shell for the game:
- DOCTYPE html, lang="fr"
- Viewport meta: `width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover`
- CSS reset: `* { margin: 0; padding: 0; box-sizing: border-box; }`, `html, body { width: 100%; height: 100%; overflow: hidden; }`, `canvas { display: block; touch-action: none; }`, `body { background: #006066; }` (fallback color matching gradient bottom)
- Single `<canvas id="game"></canvas>` element
- Script tag: `<script src="game.js"></script>`
- No title bar, no other elements -- the canvas IS the entire page

Create game.js with the following initial structure:

**Canvas initialization (initCanvas function):**
- Get canvas element by ID and 2D context
- Resize function: set `canvas.width = innerWidth * devicePixelRatio`, `canvas.height = innerHeight * devicePixelRatio`, then `ctx.scale(dpr, dpr)`. Store `canvasWidth = innerWidth` and `canvasHeight = innerHeight` (CSS pixels) as module-level variables for all game logic
- Call resize on load and on `window.addEventListener('resize', resize)`
- Listen for `document.addEventListener('visibilitychange', ...)` to pause/resume the game loop when tab loses focus (set a `paused` flag, track `lastTime` reset on resume to avoid delta-time spike)

**Background rendering (renderBackground function):**
- Linear gradient from top to bottom: `#009a9a` (lighter teal) to `#006066` (darker teal)
- Fills the entire canvas: `ctx.fillRect(0, 0, canvasWidth, canvasHeight)`
- This is the Vinted-inspired teal/turquoise gradient per CONTEXT.md

**Score display stub (renderScore function):**
- Semi-transparent dark background pill: `ctx.fillRect(10, 10, 120, 36)` with `rgba(0,0,0,0.3)`
- Score text: bold 20px sans-serif, white color, left-aligned at (18, 18)
- Display format: `+0EUR` (EUR sign is `\u20AC`). Score variable starts at 0
- Score turns red (`#ff6666`) when negative
- French label is just the number + EUR sign, no extra text needed

**Game loop skeleton:**
- `let lastTime = 0;`
- `function gameLoop(timestamp) { ... }` with delta time calculation: `const dt = Math.min((timestamp - lastTime) / 1000, 0.05);`
- Cap dt at 0.05 (50ms) to prevent physics explosions on tab resume
- Call `update(dt)` then `render()` each frame
- `render()` clears canvas with `ctx.clearRect(0, 0, canvas.width, canvas.height)` then calls `renderBackground(ctx, canvasWidth, canvasHeight)` then `renderScore(ctx, score)`
- `update(dt)` is empty for now (will be filled in Task 2 and Plan 02)
- Start with `requestAnimationFrame(gameLoop)`

All game state variables (score, arrays, flags) should be declared at the top of game.js as simple let/const variables -- no classes, no modules, no build step.
  </action>
  <verify>
Open index.html in a browser (or `python3 -m http.server 8000` and visit localhost:8000). Verify:
1. Full-screen teal gradient background with no scrollbars or white edges
2. Score display showing "+0EUR" in the top-left corner
3. No console errors
4. On mobile Chrome or DevTools mobile emulation: no scroll, no zoom on pinch, touch-action prevents browser gestures
  </verify>
  <done>
index.html loads a full-screen sharp canvas with teal gradient and score display. No scroll, no zoom, no browser interference on touch. Game loop is running at 60fps.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add pointer event input and swipe trail rendering</name>
  <files>game.js</files>
  <action>
Add to game.js:

**Trail state:**
- `const trailPoints = [];` at the top with other state variables
- `const TRAIL_LIFETIME = 150;` (ms before points fade completely)
- `const TRAIL_COLOR = '255, 200, 50';` (gold RGB per research recommendation)
- `let isPointerDown = false;`

**Pointer event handling (setupInput function):**
- `canvas.addEventListener('pointerdown', handler)` -- set `isPointerDown = true`, clear `trailPoints.length = 0`, push first point `{ x: e.clientX - rect.left, y: e.clientY - rect.top, time: performance.now() }` using `canvas.getBoundingClientRect()` for correct coordinate mapping. Call `e.preventDefault()`.
- `canvas.addEventListener('pointermove', handler)` -- if not `isPointerDown`, return. Push new point (same coordinate mapping). Hard-cap: `if (trailPoints.length > 100) trailPoints.shift()`. Call `e.preventDefault()`.
- `canvas.addEventListener('pointerup', handler)` -- set `isPointerDown = false`
- `canvas.addEventListener('pointercancel', handler)` -- set `isPointerDown = false`
- Call `setupInput(canvas)` during initialization

**Trail update (updateTrail function):**
- Called from `update(dt)`
- Remove points older than `TRAIL_LIFETIME`: `while (trailPoints.length > 0 && now - trailPoints[0].time > TRAIL_LIFETIME) { trailPoints.shift(); }`

**Trail rendering (renderTrail function):**
- Called from `render()` AFTER background, BEFORE score (trail goes under UI)
- If fewer than 2 points, return early
- For each consecutive pair of points, draw a line segment:
  - Alpha based on age: `const age = (now - p1.time) / TRAIL_LIFETIME; const alpha = Math.max(0, 1 - age);`
  - Width varies: thinner at tail (3px), thicker near finger (8px): `const widthRatio = i / trailPoints.length; ctx.lineWidth = 3 + widthRatio * 5;`
  - `ctx.strokeStyle = \`rgba(\${TRAIL_COLOR}, \${alpha})\``
  - `ctx.lineCap = 'round'` for smooth joints
  - Draw with `ctx.beginPath(); ctx.moveTo(p0.x, p0.y); ctx.lineTo(p1.x, p1.y); ctx.stroke();`

**Haptic feedback helper:**
- `function hapticFeedback(ms) { if (navigator.vibrate) navigator.vibrate(ms); }`
- Not called yet in this plan (will be called on slash in Plan 02), but the function should exist

**Wire into game loop:**
- `update(dt)` now calls `updateTrail()`
- `render()` now calls `renderTrail(ctx)` between background and score

Do NOT use `canvas.style.width/height` for sizing -- use the DPR-aware approach from Task 1. Make sure trail coordinates are in CSS pixel space (matching the ctx.scale(dpr, dpr) transform).
  </action>
  <verify>
Open index.html in a browser. Verify:
1. Click/touch and drag across the canvas -- a gold trail appears behind the cursor/finger
2. The trail fades away within ~150ms after the finger lifts
3. The trail is smooth (round line caps, no jagged edges)
4. The trail gets thicker near the finger and thinner at the tail
5. Multiple rapid swipes work correctly (old trail clears on new pointerdown)
6. No console errors
7. On mobile Chrome DevTools emulation: touch drag draws trail, no page scroll
  </verify>
  <done>
Swiping across the canvas draws a visible gold fading trail that follows the finger. Trail fades within 150ms. Multiple swipes work. No scroll or zoom interference. Haptic feedback function exists (not triggered yet).
  </done>
</task>

</tasks>

<verification>
1. Open `index.html` in Chrome (desktop or mobile DevTools emulation)
2. Canvas fills the entire viewport with a teal-to-dark-teal vertical gradient
3. No scrollbars, no zoom on pinch, no browser gesture interference
4. Score display shows "+0EUR" in top-left corner (white text on semi-transparent dark pill)
5. Swiping/dragging draws a gold fading trail that follows the cursor
6. Trail fades smoothly within ~150ms of finger lift
7. Canvas is sharp (not blurry) on Retina/high-DPI displays
8. No console errors in DevTools
9. Tab defocus pauses the loop, refocus resumes without physics jump
</verification>

<success_criteria>
- index.html and game.js exist and load without errors
- Full-screen canvas with teal gradient, no scroll/zoom
- Game loop running at 60fps with delta time
- Swipe trail visible and fading correctly
- Score display showing 0EUR
- Ready for Plan 02 to add watch entities
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-slashing/01-01-SUMMARY.md`
</output>
